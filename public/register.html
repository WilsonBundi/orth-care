<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - Orthopedic's Care Portal</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px; 
            min-height: 100vh; 
        }
        
        .container { 
            max-width: 800px; 
            margin: 0 auto;
            background: white; 
            border-radius: 16px; 
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px 40px;
            text-align: center;
        }
        
        .logo {
            font-size: 48px;
            margin-bottom: 10px;
        }
        
        h1 { 
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .subtitle {
            font-size: 14px;
            opacity: 0.9;
        }
        
        /* Progress Steps */
        .progress-container {
            background: #f8f9fa;
            padding: 30px 40px;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .progress-steps {
            display: flex;
            justify-content: space-between;
            position: relative;
        }
        
        .progress-steps::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background: #e5e7eb;
            z-index: 0;
        }
        
        .progress-line {
            position: absolute;
            top: 20px;
            left: 0;
            height: 2px;
            background: #667eea;
            transition: width 0.3s ease;
            z-index: 1;
        }
        
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
            flex: 1;
        }
        
        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 2px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }
        
        .step.active .step-circle {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .step.completed .step-circle {
            background: #10b981;
            color: white;
            border-color: #10b981;
        }
        
        .step-label {
            font-size: 12px;
            color: #666;
            text-align: center;
        }
        
        .step.active .step-label {
            color: #667eea;
            font-weight: 600;
        }
        
        /* Form Content */
        .form-content {
            padding: 40px;
        }
        
        .step-content {
            display: none;
        }
        
        .step-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .step-title {
            font-size: 22px;
            color: #1e3c72;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .step-description {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        label { 
            display: block; 
            margin-bottom: 8px; 
            color: #333; 
            font-weight: 600;
            font-size: 14px;
        }
        
        label .required {
            color: #ef4444;
        }
        
        input, select, textarea { 
            width: 100%; 
            padding: 12px; 
            border: 2px solid #e5e7eb; 
            border-radius: 8px; 
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: inherit;
        }
        
        input:focus, select:focus, textarea:focus { 
            outline: none; 
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        input.error, select.error {
            border-color: #ef4444;
        }
        
        .field-error {
            color: #ef4444;
            font-size: 12px;
            margin-top: 4px;
            display: none;
        }
        
        .field-error.show {
            display: block;
        }
        
        .info-box {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #0c4a6e;
        }
        
        .info-box strong {
            display: block;
            margin-bottom: 5px;
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .radio-option input[type="radio"] {
            width: auto;
        }
        
        /* Buttons */
        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #e5e7eb;
        }
        
        .btn { 
            padding: 14px 30px; 
            border-radius: 8px; 
            font-size: 16px; 
            font-weight: 600;
            cursor: pointer; 
            transition: all 0.3s ease;
            border: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            flex: 1;
        }
        
        .btn-primary:hover { 
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            background: #e5e7eb;
            color: #333;
        }
        
        .btn-secondary:hover {
            background: #d1d5db;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.6s linear infinite;
            margin-right: 8px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .alert { 
            padding: 14px 16px; 
            border-radius: 8px; 
            margin-bottom: 20px; 
            display: none;
            font-size: 14px;
        }
        
        .alert.error { 
            background: #fee2e2; 
            color: #991b1b; 
            border: 1px solid #fecaca;
        }
        
        .alert.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        
        .alert.show {
            display: block;
        }
        
        .link-container {
            text-align: center;
            margin-top: 20px;
            padding: 20px;
            font-size: 14px;
            color: #666;
        }
        
        .link-container a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }
        
        .link-container a:hover {
            text-decoration: underline;
        }
        
        /* Dependants Section */
        .dependant-card {
            background: #f8f9fa;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
        }
        
        .dependant-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .dependant-title {
            font-weight: 600;
            color: #1e3c72;
        }
        
        .btn-remove {
            background: #ef4444;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            border: none;
            cursor: pointer;
        }
        
        .btn-add {
            background: #10b981;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            border: none;
            cursor: pointer;
            margin-top: 10px;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                border-radius: 12px;
            }
            
            .header {
                padding: 20px;
            }
            
            .logo {
                font-size: 36px;
                margin-bottom: 8px;
            }
            
            h1 {
                font-size: 22px;
            }
            
            .subtitle {
                font-size: 12px;
            }
            
            .progress-container {
                padding: 20px 15px;
            }
            
            .progress-steps {
                gap: 5px;
            }
            
            .step-circle {
                width: 32px;
                height: 32px;
                font-size: 13px;
            }
            
            .step-label {
                font-size: 9px;
                max-width: 60px;
            }
            
            .form-content {
                padding: 20px 15px;
            }
            
            .step-title {
                font-size: 18px;
            }
            
            .step-description {
                font-size: 13px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .form-group {
                margin-bottom: 15px;
            }
            
            label {
                font-size: 13px;
            }
            
            input, select, textarea {
                padding: 10px;
                font-size: 14px;
            }
            
            .info-box {
                padding: 12px;
                font-size: 12px;
            }
            
            .radio-group {
                flex-direction: column;
                gap: 12px;
            }
            
            .form-actions {
                flex-direction: column-reverse;
                gap: 10px;
            }
            
            .btn {
                width: 100%;
                padding: 12px;
                font-size: 15px;
            }
            
            .dependant-card {
                padding: 15px;
            }
            
            .dependant-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .btn-remove {
                width: 100%;
            }
            
            .btn-add {
                width: 100%;
            }
            
            .link-container {
                padding: 15px;
                font-size: 13px;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            
            .header {
                padding: 15px;
            }
            
            .logo {
                font-size: 32px;
            }
            
            h1 {
                font-size: 20px;
            }
            
            .progress-container {
                padding: 15px 10px;
            }
            
            .step-circle {
                width: 28px;
                height: 28px;
                font-size: 12px;
            }
            
            .step-label {
                font-size: 8px;
                max-width: 50px;
            }
            
            .form-content {
                padding: 15px 10px;
            }
            
            .step-title {
                font-size: 16px;
            }
            
            .info-box {
                padding: 10px;
                font-size: 11px;
            }
        }
        
        @media (min-width: 769px) and (max-width: 1024px) {
            .container {
                max-width: 700px;
            }
            
            .form-content {
                padding: 35px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üè•</div>
            <h1>Registration</h1>
            <p class="subtitle">Complete registration to access Orthopaedics Care services</p>
        </div>
        
        <!-- Progress Steps -->
        <div class="progress-container">
            <div class="progress-steps">
                <div class="progress-line" id="progressLine"></div>
                <div class="step active" data-step="1">
                    <div class="step-circle">1</div>
                    <div class="step-label">Citizenship</div>
                </div>
                <div class="step" data-step="2">
                    <div class="step-circle">2</div>
                    <div class="step-label">Personal Info</div>
                </div>
                <div class="step" data-step="3">
                    <div class="step-circle">3</div>
                    <div class="step-label">Location</div>
                </div>
                <div class="step" data-step="4">
                    <div class="step-circle">4</div>
                    <div class="step-label">Contact</div>
                </div>
                <div class="step" data-step="5">
                    <div class="step-circle">5</div>
                    <div class="step-label">Dependants</div>
                </div>
                <div class="step" data-step="6">
                    <div class="step-circle">6</div>
                    <div class="step-label">Security</div>
                </div>
            </div>
        </div>
        
        <!-- Form Content -->
        <div class="form-content">
            <div id="alertMsg" class="alert"></div>
            
            <form id="registerForm">
                <!-- Step 1: Citizenship -->
                <div class="step-content active" data-step="1">
                    <h2 class="step-title">Citizenship Information</h2>
                    <p class="step-description">Select your citizenship status to begin registration</p>
                    
                    <div class="info-box">
                        <strong>üìã Required Documents</strong>
                        Kenyan Citizens: National ID | Foreign Nationals: Passport or Resident Permit
                    </div>
                    
                    <div class="form-group">
                        <label>Citizenship Status <span class="required">*</span></label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="citizenKenya" name="citizenship" value="kenyan" checked>
                                <label for="citizenKenya" style="margin: 0;">Kenyan Citizen</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="citizenForeign" name="citizenship" value="foreign">
                                <label for="citizenForeign" style="margin: 0;">Foreign National</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="citizenResident" name="citizenship" value="resident">
                                <label for="citizenResident" style="margin: 0;">Resident Permit</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group" id="idTypeGroup">
                        <label for="idType">Identification Type <span class="required">*</span></label>
                        <select id="idType" name="idType" required>
                            <option value="national_id">National ID</option>
                            <option value="passport">Passport</option>
                            <option value="birth_certificate">Birth Certificate (Under 18)</option>
                            <option value="refugee_id">Refugee ID</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="idNumber">ID/Passport Number <span class="required">*</span></label>
                        <input type="text" id="idNumber" name="idNumber" placeholder="Enter your ID or Passport number" required>
                        <div id="idNumberError" class="field-error"></div>
                    </div>
                </div>
                
                <!-- Step 2: Personal Information -->
                <div class="step-content" data-step="2">
                    <h2 class="step-title">Personal Information</h2>
                    <p class="step-description">Provide your personal details as they appear on your ID</p>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="firstName">First Name <span class="required">*</span></label>
                            <input type="text" id="firstName" name="firstName" required>
                            <div id="firstNameError" class="field-error"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="lastName">Last Name <span class="required">*</span></label>
                            <input type="text" id="lastName" name="lastName" required>
                            <div id="lastNameError" class="field-error"></div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="dateOfBirth">Date of Birth <span class="required">*</span></label>
                            <input type="date" id="dateOfBirth" name="dateOfBirth" 
                                   min="1920-01-01" 
                                   max="2026-12-31" 
                                   value="2005-01-01" 
                                   required>
                            <div id="dateOfBirthError" class="field-error"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="gender">Gender <span class="required">*</span></label>
                            <select id="gender" name="gender" required>
                                <option value="">Select Gender</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="other">Other</option>
                            </select>
                            <div id="genderError" class="field-error"></div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="maritalStatus">Marital Status</label>
                            <select id="maritalStatus" name="maritalStatus">
                                <option value="">Select Status</option>
                                <option value="single">Single</option>
                                <option value="married">Married</option>
                                <option value="divorced">Divorced</option>
                                <option value="widowed">Widowed</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="occupation">Occupation</label>
                            <input type="text" id="occupation" name="occupation" placeholder="Your occupation">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="kraPin">KRA PIN (Optional)</label>
                        <input type="text" id="kraPin" name="kraPin" placeholder="A000000000A">
                    </div>
                </div>
                
                <!-- Step 3: Location Information -->
                <div class="step-content" data-step="3">
                    <h2 class="step-title">Location Information</h2>
                    <p class="step-description">Provide your residential location details</p>
                    
                    <div class="form-group">
                        <label for="country">Country <span class="required">*</span></label>
                        <select id="country" name="country" required>
                            <option value="">Select Country</option>
                            <option value="Kenya" selected>Kenya</option>
                            <option value="Uganda">Uganda</option>
                            <option value="Tanzania">Tanzania</option>
                            <option value="Rwanda">Rwanda</option>
                            <option value="Burundi">Burundi</option>
                            <option value="South Sudan">South Sudan</option>
                            <option value="Other">Other</option>
                        </select>
                        <div id="countryError" class="field-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="county">County <span class="required">*</span></label>
                        <select id="county" name="county" required>
                            <option value="">Select County</option>
                            <option value="Nairobi">Nairobi</option>
                            <option value="Mombasa">Mombasa</option>
                            <option value="Kisumu">Kisumu</option>
                            <option value="Nakuru">Nakuru</option>
                            <option value="Kiambu">Kiambu</option>
                            <option value="Machakos">Machakos</option>
                            <option value="Kajiado">Kajiado</option>
                            <option value="Uasin Gishu">Uasin Gishu</option>
                            <option value="Kakamega">Kakamega</option>
                            <option value="Meru">Meru</option>
                            <option value="Kilifi">Kilifi</option>
                            <option value="Nyeri">Nyeri</option>
                            <option value="Bungoma">Bungoma</option>
                            <option value="Murang'a">Murang'a</option>
                            <option value="Kisii">Kisii</option>
                            <option value="Nandi">Nandi</option>
                            <option value="Laikipia">Laikipia</option>
                            <option value="Kericho">Kericho</option>
                            <option value="Bomet">Bomet</option>
                            <option value="Kwale">Kwale</option>
                            <option value="Other">Other</option>
                        </select>
                        <div id="countyError" class="field-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="constituency">Constituency <span class="required">*</span></label>
                        <select id="constituency" name="constituency" required disabled>
                            <option value="">Select county first</option>
                        </select>
                        <div id="constituencyError" class="field-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="ward">Ward/Sub-location</label>
                        <input type="text" id="ward" name="ward" placeholder="Enter your ward or sub-location (optional)">
                        <div id="wardError" class="field-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="address">Physical Address <span class="required">*</span></label>
                        <textarea id="address" name="address" rows="3" placeholder="Street, Building, Apartment Number" required></textarea>
                        <div id="addressError" class="field-error"></div>
                    </div>
                </div>
                
                <!-- Step 4: Contact Information -->
                <div class="step-content" data-step="4">
                    <h2 class="step-title">Contact Information</h2>
                    <p class="step-description">Provide your contact details for communication</p>
                    
                    <div class="info-box">
                        <strong>üì± OTP Verification</strong>
                        A verification code will be sent to your phone number
                    </div>
                    
                    <div class="form-group">
                        <label for="phoneNumber">Phone Number <span class="required">*</span></label>
                        <input type="tel" id="phoneNumber" name="phoneNumber" placeholder="+254 700 000 000" required>
                        <div id="phoneNumberError" class="field-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Email Address <span class="required">*</span></label>
                        <input type="email" id="email" name="email" placeholder="your.email@example.com" required>
                        <div id="emailError" class="field-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="alternatePhone">Alternate Phone Number (Optional)</label>
                        <input type="tel" id="alternatePhone" name="alternatePhone" placeholder="+254 700 000 000">
                    </div>
                </div>
                
                <!-- Step 5: Dependants -->
                <div class="step-content" data-step="5">
                    <h2 class="step-title">Dependants (Optional)</h2>
                    <p class="step-description">Add family members who will be covered under your account</p>
                    
                    <div class="info-box">
                        <strong>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Who can be added as dependants?</strong>
                        Spouse, biological children, adopted children, children in loco parentis, and disabled immediate relatives
                    </div>
                    
                    <div id="dependantsContainer">
                        <!-- Dependants will be added here dynamically -->
                    </div>
                    
                    <button type="button" class="btn-add" onclick="addDependant()">+ Add Dependant</button>
                </div>
                
                <!-- Step 6: Security -->
                <div class="step-content" data-step="6">
                    <h2 class="step-title">Security</h2>
                    <p class="step-description">Create a secure password for your account</p>
                    
                    <div class="form-group">
                        <label for="password">Password <span class="required">*</span></label>
                        <div style="position: relative;">
                            <input type="password" id="password" name="password" required style="padding-right: 45px;">
                            <button type="button" onclick="togglePassword('password')" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 20px; color: #666; padding: 5px;">
                                <span id="toggleIconPassword">üëÅÔ∏è</span>
                            </button>
                        </div>
                        <div id="passwordError" class="field-error"></div>
                        <div style="font-size: 12px; color: #666; margin-top: 5px;">
                            Minimum 8 characters with uppercase, lowercase, number, and special character
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="confirmPassword">Confirm Password <span class="required">*</span></label>
                        <div style="position: relative;">
                            <input type="password" id="confirmPassword" name="confirmPassword" required style="padding-right: 45px;">
                            <button type="button" onclick="togglePassword('confirmPassword')" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 20px; color: #666; padding: 5px;">
                                <span id="toggleIconConfirmPassword">üëÅÔ∏è</span>
                            </button>
                        </div>
                        <div id="confirmPasswordError" class="field-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px; font-weight: normal;">
                            <input type="checkbox" id="termsAccept" required style="width: auto;">
                            I accept the <a href="#" style="color: #667eea;">Terms and Conditions</a>
                        </label>
                    </div>
                </div>
                
                <!-- Form Actions -->
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="prevBtn" style="display: none;">Previous</button>
                    <button type="button" class="btn btn-primary" id="nextBtn">
                        <span id="btnText">Next</span>
                    </button>
                </div>
            </form>
        </div>
        
        <div class="link-container">
            Already have an account? <a href="/login.html">Sign in here</a><br>
            <a href="/">‚Üê Back to Home</a>
        </div>
    </div>
    
    <script>
        // Make functions global
        window.currentStep = 1;
        window.totalSteps = 6;
        window.dependantCount = 0;
        window.formData = {};

        // Toggle password visibility
        window.togglePassword = function(fieldId) {
            const passwordInput = document.getElementById(fieldId);
            const toggleIcon = document.getElementById('toggleIcon' + fieldId.charAt(0).toUpperCase() + fieldId.slice(1));
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.textContent = 'üôà';
            } else {
                passwordInput.type = 'password';
                toggleIcon.textContent = 'üëÅÔ∏è';
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM loaded, initializing...');
            
            // Add click handlers
            document.getElementById('nextBtn').addEventListener('click', function() {
                console.log('Next button clicked!');
                window.nextStep();
            });
            
            document.getElementById('prevBtn').addEventListener('click', function() {
                console.log('Previous button clicked!');
                window.previousStep();
            });
            
            window.updateProgress();
            
            // Citizenship change handler
            document.querySelectorAll('input[name="citizenship"]').forEach(radio => {
                radio.addEventListener('change', window.updateIdTypeOptions);
            });
            
            // County change handler
            document.getElementById('county').addEventListener('change', window.loadConstituencies);
            
            // Constituency change handler
            document.getElementById('constituency').addEventListener('change', window.loadWards);
            
            console.log('Initialization complete');
        });

        // Kenya location data (sample data - can be expanded)
        window.locationData = {
            'Nairobi': {
                constituencies: {
                    'Westlands': ['Kitisuru', 'Parklands/Highridge', 'Karura', 'Kangemi', 'Mountain View'],
                    'Dagoretti North': ['Kilimani', 'Kawangware', 'Gatina', 'Kileleshwa', 'Kabiro'],
                    'Dagoretti South': ['Mutu-ini', 'Ngando', 'Riruta', 'Uthiru/Ruthimitu', 'Waithaka'],
                    'Langata': ['Karen', 'Nairobi West', 'Mugumo-ini', 'South C', 'Nyayo Highrise'],
                    'Kibra': ['Laini Saba', 'Lindi', 'Makina', 'Woodley/Kenyatta Golf Course', 'Sarang\'ombe'],
                    'Roysambu': ['Githurai', 'Kahawa West', 'Zimmerman', 'Roysambu', 'Kahawa'],
                    'Kasarani': ['Clay City', 'Mwiki', 'Kasarani', 'Njiru', 'Ruai'],
                    'Ruaraka': ['Baba Dogo', 'Utalii', 'Mathare North', 'Lucky Summer', 'Korogocho'],
                    'Embakasi South': ['Imara Daima', 'Kwa Njenga', 'Kwa Reuben', 'Pipeline', 'Kware'],
                    'Embakasi North': ['Kariobangi North', 'Dandora Area I', 'Dandora Area II', 'Dandora Area III', 'Dandora Area IV'],
                    'Embakasi Central': ['Kayole North', 'Kayole Central', 'Kayole South', 'Komarock', 'Matopeni/Spring Valley'],
                    'Embakasi East': ['Upper Savannah', 'Lower Savannah', 'Embakasi', 'Utawala', 'Mihang\'o'],
                    'Embakasi West': ['Umoja I', 'Umoja II', 'Mowlem', 'Kariobangi South'],
                    'Makadara': ['Maringo/Hamza', 'Viwandani', 'Harambee', 'Makongeni'],
                    'Kamukunji': ['Pumwani', 'Eastleigh North', 'Eastleigh South', 'Airbase', 'California'],
                    'Starehe': ['Nairobi Central', 'Ngara', 'Pangani', 'Ziwani/Kariokor', 'Landimawe', 'Nairobi South'],
                    'Mathare': ['Hospital', 'Mabatini', 'Huruma', 'Ngei', 'Mlango Kubwa', 'Kiamaiko']
                }
            },
            'Mombasa': {
                constituencies: {
                    'Changamwe': ['Port Reitz', 'Kipevu', 'Airport', 'Changamwe', 'Chaani'],
                    'Jomvu': ['Jomvu Kuu', 'Miritini', 'Mikindani'],
                    'Kisauni': ['Mjambere', 'Junda', 'Bamburi', 'Mwakirunge', 'Mtopanga', 'Magogoni', 'Shanzu'],
                    'Nyali': ['Frere Town', 'Ziwa La Ng\'ombe', 'Mkomani', 'Kongowea', 'Kadzandani'],
                    'Likoni': ['Mtongwe', 'Shika Adabu', 'Bofu', 'Likoni', 'Timbwani'],
                    'Mvita': ['Mji Wa Kale/Makadara', 'Tudor', 'Tononoka', 'Shimanzi/Ganjoni', 'Majengo']
                }
            },
            'Kisumu': {
                constituencies: {
                    'Kisumu East': ['Kajulu', 'Kolwa East', 'Manyatta B', 'Nyalenda A'],
                    'Kisumu West': ['Central Kisumu', 'Kisumu North', 'West Kisumu', 'North West Kisumu', 'South West Kisumu'],
                    'Kisumu Central': ['Railways', 'Migosi', 'Shaurimoyo Kaloleni', 'Market Milimani', 'Kondele', 'Nyalenda B'],
                    'Seme': ['West Seme', 'Central Seme', 'East Seme', 'North Seme'],
                    'Nyando': ['West Kano', 'Awasi/Onjiko', 'Ahero', 'Kabonyo/Kanyagwal', 'Kobura'],
                    'Muhoroni': ['Miwani', 'Ombeyi', 'Masogo/Nyang\'oma', 'Chemelil', 'Muhoroni/Koru'],
                    'Nyakach': ['South West Nyakach', 'North Nyakach', 'Central Nyakach', 'West Nyakach', 'South East Nyakach']
                }
            },
            'Nakuru': {
                constituencies: {
                    'Nakuru Town West': ['Kapkures', 'Flamingo', 'Menengai West', 'London', 'Kaptembwo', 'Shabaab'],
                    'Nakuru Town East': ['Biashara', 'Kivumbini', 'Flamingo', 'Menengai East', 'Nakuru East'],
                    'Gilgil': ['Gilgil', 'Elementaita', 'Mbaruk/Eburu', 'Malewa West', 'Nyahururu'],
                    'Naivasha': ['Naivasha East', 'Viwandani', 'Hells Gate', 'Olkaria', 'Naivasha West', 'Maiella'],
                    'Kuresoi South': ['Amalo', 'Keringet', 'Kiptagich', 'Waldai'],
                    'Kuresoi North': ['Kiptororo', 'Nyota', 'Sirikwa', 'Kamara'],
                    'Molo': ['Mariashoni', 'Elburgon', 'Molo', 'Turi'],
                    'Njoro': ['Mauche', 'Kihingo', 'Mau Narok', 'Njoro', 'Lare', 'Nessuit'],
                    'Rongai': ['Menengai', 'Rongai', 'Soin', 'Mosop', 'Solai'],
                    'Subukia': ['Subukia', 'Waseges', 'Kabazi']
                }
            },
            'Kiambu': {
                constituencies: {
                    'Gatundu South': ['Kiamwangi', 'Kiganjo', 'Ndarugu', 'Ngenda'],
                    'Gatundu North': ['Gituamba', 'Githobokoni', 'Chania', 'Mang\'u'],
                    'Juja': ['Murera', 'Theta', 'Juja', 'Witeithie', 'Kalimoni'],
                    'Thika Town': ['Township', 'Kamenu', 'Hospital', 'Gatuanyaga', 'Ngoliba'],
                    'Ruiru': ['Biashara', 'Gatongora', 'Kahawa Sukari', 'Kahawa Wendani', 'Kiuu', 'Mwiki', 'Mwihoko'],
                    'Githunguri': ['Githunguri', 'Githiga', 'Ikinu', 'Ngewa', 'Komothai'],
                    'Kiambu': ['Ndumberi', 'Riabai', 'Township', 'Ting\'ang\'a', 'Uthiru'],
                    'Kiambaa': ['Cianda', 'Karuri', 'Ndenderu', 'Muchatha', 'Kihara'],
                    'Kabete': ['Gitaru', 'Muguga', 'Nyadhuna', 'Kabete', 'Uthiru'],
                    'Kikuyu': ['Karai', 'Nachu', 'Sigona', 'Kikuyu', 'Kinoo'],
                    'Limuru': ['Bibirioni', 'Limuru Central', 'Limuru East', 'Ndeiya', 'Ngecha Tigoni'],
                    'Lari': ['Kinale', 'Kijabe', 'Nyanduma', 'Kamburu', 'Lari/Kirenga']
                }
            },
            'Meru': {
                constituencies: {
                    'Igembe South': ['Kangeta', 'Naathu', 'Athiru Ruujine', 'Akachiu', 'Muthara'],
                    'Igembe Central': ['Igembe Central', 'Akirang\'ondu', 'Athiru Gaiti', 'Akithi'],
                    'Igembe North': ['Igembe North', 'Antubochiu', 'Ntunene', 'Antuambui'],
                    'Tigania West': ['Tigania West', 'Kianjai', 'Nkomo', 'Mbeu', 'Akithii'],
                    'Tigania East': ['Tigania East', 'Muthara', 'Karama', 'Mikinduri', 'Thangatha'],
                    'North Imenti': ['Nyaki West', 'Nyaki East', 'Ntima West', 'Ntima East', 'Municipality'],
                    'Buuri': ['Timau', 'Kisima', 'Kiirua/Naari', 'Ruiri/Rwarera', 'Mitunguu'],
                    'Central Imenti': ['Abothuguchi Central', 'Abothuguchi West', 'Kiagu', 'Mitunguu'],
                    'South Imenti': ['Igoji East', 'Igoji West', 'Nkuene', 'Abogeta East', 'Abogeta West', 'Mitunguu']
                }
            }
        };

        window.loadConstituencies = function() {
            const county = document.getElementById('county').value;
            const constituencySelect = document.getElementById('constituency');
            const wardSelect = document.getElementById('ward');
            
            // Reset constituency and ward
            constituencySelect.innerHTML = '<option value="">Select Constituency</option>';
            wardSelect.innerHTML = '<option value="">Select constituency first</option>';
            wardSelect.disabled = true;
            
            if (county && window.locationData[county]) {
                constituencySelect.disabled = false;
                const constituencies = Object.keys(window.locationData[county].constituencies);
                constituencies.forEach(constituency => {
                    const option = document.createElement('option');
                    option.value = constituency;
                    option.textContent = constituency;
                    constituencySelect.appendChild(option);
                });
            } else {
                constituencySelect.disabled = true;
            }
        };

        window.loadWards = function() {
            const county = document.getElementById('county').value;
            const constituency = document.getElementById('constituency').value;
            const wardSelect = document.getElementById('ward');
            
            // Reset ward
            wardSelect.innerHTML = '<option value="">Select Ward</option>';
            
            if (county && constituency && window.locationData[county] && window.locationData[county].constituencies[constituency]) {
                wardSelect.disabled = false;
                const wards = window.locationData[county].constituencies[constituency];
                wards.forEach(ward => {
                    const option = document.createElement('option');
                    option.value = ward;
                    option.textContent = ward;
                    wardSelect.appendChild(option);
                });
            } else {
                wardSelect.disabled = true;
            }
        };

        window.updateProgress = function() {
            const progressLine = document.getElementById('progressLine');
            const progress = ((window.currentStep - 1) / (window.totalSteps - 1)) * 100;
            progressLine.style.width = progress + '%';
            
            // Update step indicators
            document.querySelectorAll('.step').forEach((step, index) => {
                const stepNum = index + 1;
                step.classList.remove('active', 'completed');
                
                if (stepNum < window.currentStep) {
                    step.classList.add('completed');
                } else if (stepNum === window.currentStep) {
                    step.classList.add('active');
                }
            });
            
            // Show/hide buttons
            document.getElementById('prevBtn').style.display = window.currentStep === 1 ? 'none' : 'block';
            document.getElementById('btnText').textContent = window.currentStep === window.totalSteps ? 'Complete Registration' : 'Next';
        }

        window.nextStep = function() {
            console.log('Next button clicked, current step:', window.currentStep);
            
            if (!window.validateCurrentStep()) {
                console.log('Validation failed');
                return;
            }
            
            window.saveCurrentStepData();
            
            if (window.currentStep === window.totalSteps) {
                window.submitRegistration();
                return;
            }
            
            // Hide current step
            document.querySelector(`.step-content[data-step="${window.currentStep}"]`).classList.remove('active');
            
            // Show next step
            window.currentStep++;
            document.querySelector(`.step-content[data-step="${window.currentStep}"]`).classList.add('active');
            
            window.updateProgress();
            window.scrollTo(0, 0);
            console.log('Moved to step:', window.currentStep);
        }

        window.previousStep = function() {
            if (window.currentStep === 1) return;
            
            // Hide current step
            document.querySelector(`.step-content[data-step="${window.currentStep}"]`).classList.remove('active');
            
            // Show previous step
            window.currentStep--;
            document.querySelector(`.step-content[data-step="${window.currentStep}"]`).classList.add('active');
            
            updateProgress();
            window.scrollTo(0, 0);
        }

        window.validateCurrentStep = function() {
            window.hideAlert();
            window.clearAllErrors();
            
            let isValid = true;
            
            switch(window.currentStep) {
                case 1: // Citizenship
                    if (!document.querySelector('input[name="citizenship"]:checked')) {
                        window.showAlert('Please select your citizenship status', 'error');
                        isValid = false;
                    }
                    if (!document.getElementById('idNumber').value.trim()) {
                        window.showFieldError('idNumber', 'ID/Passport number is required');
                        isValid = false;
                    }
                    break;
                    
                case 2: // Personal Info
                    if (!document.getElementById('firstName').value.trim()) {
                        window.showFieldError('firstName', 'First name is required');
                        isValid = false;
                    }
                    if (!document.getElementById('lastName').value.trim()) {
                        window.showFieldError('lastName', 'Last name is required');
                        isValid = false;
                    }
                    if (!document.getElementById('dateOfBirth').value) {
                        window.showFieldError('dateOfBirth', 'Date of birth is required');
                        isValid = false;
                    }
                    if (!document.getElementById('gender').value) {
                        window.showFieldError('gender', 'Gender is required');
                        isValid = false;
                    }
                    break;
                    
                case 3: // Location
                    if (!document.getElementById('country').value) {
                        window.showFieldError('country', 'Country is required');
                        isValid = false;
                    }
                    if (!document.getElementById('county').value) {
                        window.showFieldError('county', 'County is required');
                        isValid = false;
                    }
                    if (!document.getElementById('constituency').value) {
                        window.showFieldError('constituency', 'Constituency is required');
                        isValid = false;
                    }
                    // Ward is optional
                    if (!document.getElementById('address').value.trim()) {
                        window.showFieldError('address', 'Physical address is required');
                        isValid = false;
                    }
                    break;
                    
                case 4: // Contact
                    const phone = document.getElementById('phoneNumber').value.trim();
                    const email = document.getElementById('email').value.trim();
                    
                    if (!phone) {
                        window.showFieldError('phoneNumber', 'Phone number is required');
                        isValid = false;
                    } else if (!window.validatePhone(phone)) {
                        window.showFieldError('phoneNumber', 'Invalid phone format. Use: +254 700 000 000');
                        isValid = false;
                    }
                    
                    if (!email) {
                        window.showFieldError('email', 'Email is required');
                        isValid = false;
                    } else if (!window.validateEmail(email)) {
                        window.showFieldError('email', 'Invalid email address');
                        isValid = false;
                    }
                    break;
                    
                case 5: // Dependants (optional, no validation needed)
                    break;
                    
                case 6: // Security
                    const password = document.getElementById('password').value;
                    const confirmPassword = document.getElementById('confirmPassword').value;
                    
                    if (!password) {
                        window.showFieldError('password', 'Password is required');
                        isValid = false;
                    } else if (!window.validatePassword(password)) {
                        window.showFieldError('password', 'Password must be at least 8 characters with uppercase, lowercase, number, and special character');
                        isValid = false;
                    }
                    
                    if (password !== confirmPassword) {
                        window.showFieldError('confirmPassword', 'Passwords do not match');
                        isValid = false;
                    }
                    
                    if (!document.getElementById('termsAccept').checked) {
                        window.showAlert('Please accept the terms and conditions', 'error');
                        isValid = false;
                    }
                    break;
            }
            
            if (!isValid) {
                window.showAlert('Please fix the errors above', 'error');
            }
            
            return isValid;
        }

        window.saveCurrentStepData = function() {
            const inputs = document.querySelector(`.step-content[data-step="${window.currentStep}"]`).querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                if (input.type === 'radio') {
                    if (input.checked) {
                        window.formData[input.name] = input.value;
                    }
                } else if (input.type === 'checkbox') {
                    window.formData[input.name] = input.checked;
                } else {
                    window.formData[input.name] = input.value;
                }
            });
        }

        window.addDependant = function() {
            window.dependantCount++;
            const container = document.getElementById('dependantsContainer');
            
            const dependantCard = document.createElement('div');
            dependantCard.className = 'dependant-card';
            dependantCard.id = `dependant-${window.dependantCount}`;
            
            dependantCard.innerHTML = `
                <div class="dependant-header">
                    <div class="dependant-title">Dependant ${window.dependantCount}</div>
                    <button type="button" class="btn-remove" onclick="removeDependant(${window.dependantCount})">Remove</button>
                </div>
                
                <div class="form-group">
                    <label>Relationship <span class="required">*</span></label>
                    <select name="dependant_${window.dependantCount}_relationship" required>
                        <option value="">Select Relationship</option>
                        <option value="spouse">Spouse</option>
                        <option value="child">Biological Child</option>
                        <option value="adopted">Adopted Child</option>
                        <option value="loco_parentis">Child in Loco Parentis</option>
                        <option value="disabled_relative">Disabled Relative</option>
                    </select>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>First Name <span class="required">*</span></label>
                        <input type="text" name="dependant_${window.dependantCount}_firstName" required>
                    </div>
                    <div class="form-group">
                        <label>Last Name <span class="required">*</span></label>
                        <input type="text" name="dependant_${window.dependantCount}_lastName" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>ID/Birth Certificate Number <span class="required">*</span></label>
                        <input type="text" name="dependant_${window.dependantCount}_idNumber" required>
                    </div>
                    <div class="form-group">
                        <label>Date of Birth <span class="required">*</span></label>
                        <input type="date" name="dependant_${window.dependantCount}_dob" 
                               min="1920-01-01" 
                               max="2026-12-31" 
                               value="2010-01-01" 
                               required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Gender <span class="required">*</span></label>
                    <select name="dependant_${window.dependantCount}_gender" required>
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>
            `;
            
            container.appendChild(dependantCard);
        }

        window.removeDependant = function(id) {
            const card = document.getElementById(`dependant-${id}`);
            if (card) {
                card.remove();
            }
        }

        window.updateIdTypeOptions = function() {
            const citizenship = document.querySelector('input[name="citizenship"]:checked').value;
            const idTypeSelect = document.getElementById('idType');
            
            idTypeSelect.innerHTML = '';
            
            if (citizenship === 'kenyan') {
                idTypeSelect.innerHTML = `
                    <option value="national_id">National ID</option>
                    <option value="birth_certificate">Birth Certificate (Under 18)</option>
                `;
            } else if (citizenship === 'foreign') {
                idTypeSelect.innerHTML = `
                    <option value="passport">Passport</option>
                    <option value="refugee_id">Refugee ID</option>
                `;
            } else if (citizenship === 'resident') {
                idTypeSelect.innerHTML = `
                    <option value="passport">Passport</option>
                    <option value="resident_permit">Resident Permit</option>
                `;
            }
        }

        window.submitRegistration = async function() {
            window.setLoading(true);
            
            try {
                // Collect all form data
                window.saveCurrentStepData();
                
                // Collect dependants
                const dependants = [];
                document.querySelectorAll('.dependant-card').forEach(card => {
                    const inputs = card.querySelectorAll('input, select');
                    const dependant = {};
                    inputs.forEach(input => {
                        const key = input.name.split('_').pop();
                        dependant[key] = input.value;
                    });
                    dependants.push(dependant);
                });
                
                window.formData.dependants = dependants;
                
                const response = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(window.formData)
                });
                
                const data = await response.json();
                
                console.log('Registration response:', response.status, data);
                
                if (response.ok) {
                    window.showAlert('Registration successful! Redirecting to dashboard...', 'success');
                    
                    // Store auth data
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));
                    
                    // Store complete profile data for profile view
                    localStorage.setItem('profileData', JSON.stringify(window.formData));
                    
                    setTimeout(() => {
                        window.location.href = '/dashboard.html';
                    }, 2000);
                } else {
                    // Show the actual error from server
                    const errorMessage = data.error || data.message || 'Registration failed. Please try again.';
                    window.showAlert(errorMessage, 'error');
                    console.error('Registration failed:', data);
                }
            } catch (error) {
                console.error('Registration error:', error);
                window.showAlert('Network error. Please check your connection and try again.', 'error');
            } finally {
                window.setLoading(false);
            }
        }

        // Validation helpers
        window.validateEmail = function(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        window.validatePhone = function(phone) {
            return /^\+254\s?\d{3}\s?\d{3}\s?\d{3}$/.test(phone);
        }

        window.validatePassword = function(password) {
            return password.length >= 8 &&
                   /[A-Z]/.test(password) &&
                   /[a-z]/.test(password) &&
                   /[0-9]/.test(password) &&
                   /[^A-Za-z0-9]/.test(password);
        }

        // UI helpers
        window.showFieldError = function(field, message) {
            const input = document.getElementById(field);
            const error = document.getElementById(field + 'Error');
            if (input) input.classList.add('error');
            if (error) {
                error.textContent = message;
                error.classList.add('show');
            }
        }

        window.clearFieldError = function(field) {
            const input = document.getElementById(field);
            const error = document.getElementById(field + 'Error');
            if (input) input.classList.remove('error');
            if (error) {
                error.classList.remove('show');
                error.textContent = '';
            }
        }

        window.clearAllErrors = function() {
            document.querySelectorAll('.field-error').forEach(el => el.classList.remove('show'));
            document.querySelectorAll('input, select').forEach(el => el.classList.remove('error'));
        }

        window.showAlert = function(message, type = 'error') {
            const alertMsg = document.getElementById('alertMsg');
            alertMsg.textContent = message;
            alertMsg.className = 'alert ' + type + ' show';
            alertMsg.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        window.hideAlert = function() {
            document.getElementById('alertMsg').classList.remove('show');
        }

        window.setLoading = function(loading) {
            const btn = document.getElementById('nextBtn');
            const btnText = document.getElementById('btnText');
            btn.disabled = loading;
            if (loading) {
                btnText.innerHTML = '<span class="loading"></span>Processing...';
            } else {
                btnText.textContent = window.currentStep === window.totalSteps ? 'Complete Registration' : 'Next';
            }
        }

        // Clear errors on input
        document.addEventListener('input', (e) => {
            if (e.target.id) {
                window.clearFieldError(e.target.id);
            }
        });
    </script>
    
    <!-- Location Data Loader -->
    <script src="/js/location-loader.js"></script>
</body>
</html>
